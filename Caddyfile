# Outline Caddyfile for Cloudflare subdomain

outline.milagros.me {
  reverse_proxy outline:3000
}

http://mail.milagros.me {
  # Allow Mailu ACME self-check on plain HTTP before forcing HTTPS
  @mailu_acme path /.well-known/acme-challenge/*
  handle @mailu_acme {
    reverse_proxy mailu-front:80
  }

  redir https://mail.milagros.me{uri} 308
}

https://mail.milagros.me {
  @acme {
    path /.well-known/acme-challenge/*
  }
  handle @acme {
    reverse_proxy mailu-front:80
  }
  handle {
    reverse_proxy mailu-front:80
  }
}